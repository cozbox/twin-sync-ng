# Plan Schema
# Defines the structure for plan files (plan/latest.yaml, plan/history/*.yaml)

type: object
description: "Action plan generated by comparing state/ to live/"
patternProperties:
  "^[a-z0-9]+\\.[a-z0-9_]+$":
    type: array
    description: "List of actions for a specific plugin"
    items:
      type: object
      required:
        - op
      properties:
        op:
          type: string
          description: "Operation to perform (create, replace, install, remove, enable, disable, start, stop, update, etc.)"
        
        # Common fields
        name:
          type: string
          description: "Resource name (package, service, file, etc.)"
        
        path:
          type: string
          description: "File system path (for file operations)"
        
        content:
          type: string
          description: "File content or configuration data"
        
        mode:
          type: string
          description: "File permissions in octal (e.g., '0644')"
        
        # Package-specific
        version:
          type: string
          description: "Package version"
        
        # Service-specific
        enabled:
          type: boolean
          description: "Whether service should be enabled"
        
        running:
          type: boolean
          description: "Whether service should be running"
        
        # Additional metadata
        reason:
          type: string
          description: "Why this action is needed"
        
        priority:
          type: integer
          description: "Execution priority (lower runs first)"
          default: 100

properties:
  _metadata:
    type: object
    description: "Optional metadata about the plan"
    properties:
      generated_at:
        type: string
        format: date-time
        description: "When the plan was generated"
      
      generator_version:
        type: string
        description: "Version of TwinSync++ that generated this plan"
      
      total_actions:
        type: integer
        description: "Total number of actions in the plan"
      
      estimated_duration:
        type: string
        description: "Estimated time to execute plan"
